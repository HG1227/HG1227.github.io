---
layout: post
title:  方差分析
date:   2020-02-18
categories: statistics
tags:  
---
* content
{:toc}








## 相关术语

**方差分析**(analysis of variance, ANOVA) 是通过检验各总体均值是否相等来判断分类型自变量对数值型因变量是否有显著影响

【例 10.1】为了对几个行业的服务质量进行评价，消费者协会在四个行业分别抽取了不同的企业作为样本。最近 一年中消费者对总共23家企业投诉的次数如下表:

<center><img src="https://raw.githubusercontent.com/HG1227/image/master/img_tuchuang/20200618113932.png" alt="image-20200618092330763" style="zoom: 33%;" /></center>

一般而言，受到投诉的次数越多，说明服务的质量越差。消费者协会想知道这几个行业之间的服务质量是否有显著差异。

要分析四个行业之间的服务质量是否有显著差异，实际上也就是要判断行业对被投诉次数是否有显著影响，作出这种判断最终被归结为检验这四个行业被投诉次数的均值是否相等。如果它们的均值相等，就意味着行业对被投诉次数是没有影响的，也就是它们之间的服务质量没有显著差异;如果均值不全相等，则意味着行业对被投诉次数是有影响的，它们之间的服务质量应该有显著差异。

在方差分析中，所要检验的对象称为**因素**或**因子**(factor)。 因素的不同表现称为**水平**或**处理**(treatment)。 每个因子水平下得到的样本数据称为**观测值**。

例如，在例10,1中，要分析行业对被投诉次数是否有显著影响。这里的行业是要检验的对象，称为因素或因子; 零售业、旅游业、航空公司、家电制造业是行业这一因素的具体表现，称为水平或处理; 在每个行业下得到的样本数据(被投诉次数)称为观测值。由于这里只涉及行业一个因素，因此称为单因素4水平的试验。因素的每一个水平可以看做一个总体，如零售业、旅游业、航空公司、家电制造业可以看做4个总体，上 面的数据可以看做从这4个总体中抽取的样本数据。

## 基本思想和原理

### 1. 图形描述

可以绘制各个总体的 箱线图，或者带有均值的散点图

<center><img src="https://raw.githubusercontent.com/HG1227/image/master/img_tuchuang/20200618114015.png" alt="Snipaste_2020-06-18_10-35-54 (1)" style="zoom:50%;" /></center>

从散点图可以看出，不同行业被投诉的次数是有明显差异的，而且，即使是在同一个行业，不同企业被投诉的次数也明显不同。从图中可以看出，家电制造业被投诉的次数较多，而航空公司被投诉的次数较少。这表明行业与被投诉次数之间有一定的关系。如果行业与被投诉次数之间没有关系，那么它们被投诉次数的均值应该差不多相同，在散点图上所呈现的模式就应该很接近。



### 2. 误差分解

**随机误差**

因素的同一水平(总体)下，样本各观察值之间的差异 ，比如，同一行业下不同企业被投诉次数是不同的 。这种差异可以看成是随机因素的影响，称为随机误差

**系统误差**

因素的不同水平(不同总体)下，各观察值之间的差异 ， 比如，不同行业之间的被投诉次数之间的差异 。 这种差异可能是由于抽样的随机性所造成的，也可能是由 于行业本身所造成的，后者所形成的误差是由系统性因素 造成的，称为系统误差

首先，注意到在同一行业(同一个总体)中，样本的各观测值是不同的。例如，在零售业中，所抽取的7家企业之间被投诉的次数是不同的。由于企业是随机抽取的，因此它们之间的差异可以看成是随机因素的影响造成的，或者说是由抽样的随机性所造成的随机误差。这种来自水平内部的数据误差也称为**组内误差**。例如，零售业中所抽取的7家企业被投诉次数之间的误差就是组内误差，<u>它反映了一个样本内部数据的离散程度</u>。显然，<u>组内误差只含有随机误差</u>。

其次，不同行业(不同总体)之间的观测值也是不同的。来自不同水平之间的数据误差称为**组间误差**。这种差异可能是由抽样本身形成的随机误差，也可能是由行业本身的系统性因素造成的系统误差。因此，组间误差是随机误差和系统误差的总和。例如，四个行业被投诉次数之间的误差就是组间误差，<u>它反映了不同样本之间数据的离散程度</u>。

在方差分析中，数据的误差用平方和 (sum of squares) 表示的。称为方差

**总平方和**( $SST$ ) 反应全部数据误差大小的平方和。例如，所抽取的全部 23 家企业被投诉次数之间的误差平方和，<u>它反映了全部观测值的离散状况</u>

**组内平方和** ($SSE$) 反映组内误差大小的平方和，也称误差平方和或残差平方和。例如，每个样本内部的数据平方和加在一起就是组内平方和，<u>它反映每个样本内观测值的离散状况。</u> 

**因素平方和** ($SSA$) 它反映组间误差大小的平方和，也称为因素平方和。例如，四个行业被投诉次数之间的误差平方和就是组间平方和，<u>它反映样本均值之间的差异程度</u>

<center>![Untitled Diagram](https://raw.githubusercontent.com/HG1227/image/master/img_tuchuang/20200618114040.png)</center>

### 3. 误差分析

- 若因素不同水平对试验指标没有影响，则组间误差中 只包含随机误差，没有系统误差。这时，组间误差与组内误差经过平均后的数值就应该很接近，它们的比值就会接近1 

- 若因素不同水平对试验指标有影响，在组间误差中除 了包含随机误差外，还会包含有系统误差，这时组间 误差平均后的数值就会大于组内误差平均后的数值， 它们之间的比值就会大于1 
- 当这个比值大到某种程度时，就可以说不同水平之间 存在着显著差异，也就是自变量对因变量有影响

## 方差分析中的基本假定

方差分析中有三个基本假定：

（1）每一个总体都应服从正态分布。也就是说，对于因素的每一个水平，其观察值是来自服从正态分布总体的简单随机样本

（2）各个总体的方差 $\sigma ^2$ 必须相同。也就是说，各组观察数据是从具有相同方差的正态总体中抽取的。

（3）观测值是独立的。例如，在例10.1中，要求每个被抽中的企业被投诉的次数都与其他企业被投诉的次数独立。

## 方差分析中基本假定

**如果原假设成立**，即 $H_0 ： \mu_1 =\mu_2= \mu_3= \mu_4$

- 四个行业被投诉次数的均值都相等
-  意味着每个样本都来自均值为 $\mu$、方差为 $\sigma^2$ 的同一正态 总体

<img src="C:\Users\Hu\Desktop\Snipaste_2020-06-18_11-24-46 (1).png" alt="Snipaste_2020-06-18_11-24-46 (1)" style="zoom:67%;" />



**若备择假设成立**，即 $H1 ：\mu_i (i=1,2,3,4)$不全相等 

- 至少有一个总体的均值是不同的 
-  四个样本分别来自均值不同的四个正态总体

<img src="C:\Users\Hu\Desktop\Snipaste_2020-06-18_11-26-44 (1).png" alt="Snipaste_2020-06-18_11-26-44 (1)" style="zoom:67%;" />



## 单因素方差分析

根据所分析的分类型自变量的多少，方差分析可分为单因素方差分析和双因素方差分析。

**单因素方差分析**

当方差分析中只涉及一个分类型自变量时称为**单因素方差分析**(one-way analysis of variance) 。单因素方差分析研究的是一个分类型自变量对-一个数值型因变量的影响。例如，要检验不同行业被投诉次数的均值是否相等，这里只涉及行业-一个因素，因而属于单因素方差分析。

### 1. 数据结构

