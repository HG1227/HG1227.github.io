---
layout: post
title:  MySQL 基础 01
date:   2020-4-22
categories: MySQL
tags:  MySQL
---
* content
{:toc}






# 连接服务器

使用 [mysql](https://dev.mysql.com/doc/refman/8.0/en/mysql.html) 客户端工具连接 MySQL 服务器的命令行如下：

```sql
mysql [-h host_name] [-P port_num] [-u user_name] [-p] [-D db_name]
```

其中，*host_name* 表示服务器主机名，默认为本机；*port_num* 表示 MySQL 服务端口，默认为 3306；*user_name* 表示用户名，默认为当前操作系统用户；-p 提示输入密码；*db_name* 表示要连接的数据库。



mysql 中的 SQL 命令支持以`;`、`\g` 或者`\G`结束并发送到服务器。

```sql
mysql> select version();
+-----------+
| version() |
+-----------+
| 8.0.19    |
+-----------+
1 row in set (0.00 sec)

```

# 查看连接

使用`show processlist`命令可以查看所有连接到服务器的进程：

```sql
mysql> show processlist;
```

使用`kill pid`命令杀掉指定连接进程：

```sql
mysql> kill 23;
```

# 退出连接

使用`exit;`、`quit;`或者`\q`命令退出 mysql 客户端：

```sql
mysql> exit;
Bye

```

# 创建用户

使用`CREATE USER`语句创建一个用户：

```sql
CREATE USER [IF NOT EXISTS] user_name@host IDENTIFIED BY 'auth_string';
```

其中，*user_name* 表示用户名；*host* 表示允许用户从哪个主机连接 MySQL 服务器，如果省略（等价于 %）表示任何主机；IDENTIFIED BY 用于指定用户的密码。

```sql
mysql> create user tony identified by 'Pswd123!';
Query OK, 0 rows affected (0.14 sec)

```

# 查看用户

MySQL 中的用户信息存储在 mysql.user 系统表中。

使用 user() 或者 current_user() 函数查看当前用户：

```sql
mysql> select user();
+----------------+
| user()         |
+----------------+
| root@localhost |
+----------------+
1 row in set (0.00 sec)

```

# 修改密码

使用`ALTER USER`语句修改用户的密码：

```sql
mysql> alter user tony identified by 'Pswd123@';
Query OK, 0 rows affected (0.12 sec)

```

# 锁定/解锁用户

使用`ALTER USER`语句锁定或者解锁用户：

```sql
mysql> alter user tony account lock;
Query OK, 0 rows affected (0.10 sec)

mysql> alter user tony account unlock;
Query OK, 0 rows affected (0.10 sec)

```

其中，`account lock` 表示锁定；`account unlock` 表示解锁。

# 用户授权

MySQL 使用`GRANT`语句给用户授权：

```sql
GRANT priv_type [, priv_type] ...
   ON priv_level
   TO user_name@host；

```

其中，priv_type 表示权限，例如查询（SELECT）、执行（EXECUTE）、全部（ALL）权限等；priv_level 表示权限的级别，分为全局（*.*）、数据库（db.*）、表级（db.table）权限等。以下语句为用户 tony 授予 hrdb 数据库中 employees 表上的增删改查权限：

```sql
mysql> grant select,insert,update,delete 
    -> on hrdb.employees
    -> to tony;
Query OK, 0 rows affected (0.07 sec)

```

# 查看权限

使用`SHOW GRANTS [FOR user_name]`语句查看授予用户的权限和角色：

```sql
mysql> SHOW GRANTS FOR tony;
+--------------------------------------------------------------------------+
| Grants for tony@%                                                        |
+--------------------------------------------------------------------------+
| GRANT USAGE ON *.* TO `tony`@`%`                                         |
| GRANT SELECT, INSERT, UPDATE, DELETE ON `hrdb`.`employees` TO `tony`@`%` |
+--------------------------------------------------------------------------+
2 rows in set (0.00 sec)

```

如果省略 FOR user_name，返回当前用户的权限和角色。

# 查看数据库

使用`show databases;`命令查看当前 MySQL 服务器中所有可用的数据库：

```sql
mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| ds                 |
| hrdb               |
| information_schema |
| mydb               |
| mysql              |
| performance_schema |
| sys                |
| world_x            |
+--------------------+
8 rows in set (0.00 sec)

```

# 创建数据库

使用`CREATE DATABASE`语句创建一个新的数据库：

```sql
CREATE DATABASE [IF NOT EXISTS] db_name [CHARACTER SET charset_name]
```

其中，*db_name* 是数据库的名称；如果该数据库已经存在，将会返回错误；此时如果指定了 IF NOT EXISTS 选项，不会返回错误。

```sql
mysql> create database testdb;
Query OK, 1 row affected (0.15 sec)

mysql> create database testdb;
ERROR 1007 (HY000): Can't create database 'testdb'; database exists
mysql> create database if not exists testdb;
Query OK, 1 row affected, 1 warning (0.05 sec)

mysql> show warnings;
+-------+------+-------------------------------------------------+
| Level | Code | Message                                         |
+-------+------+-------------------------------------------------+
| Note  | 1007 | Can't create database 'testdb'; database exists |
+-------+------+-------------------------------------------------+
1 row in set (0.00 sec)

```

# 切换数据库

使用`USE db_name;`语句切换当前默认的数据库：

```sql
mysql> use testdb;
Database changed

```

# 删除数据库

使用`DROP DATABASE`语句删除一个数据库，该数据库中的所有对象以及与该数据库相关的数据文件也会被删除：

```sql
DROP DATABASE [IF EXISTS] db_name;
```

将 testdb 数据库和相关的数据文件删除：

```sql
mysql> drop database testdb;
Query OK, 0 rows affected (0.23 sec)
```

# 创建表

MySQL 使用`CREATE TABLE`语句创建表：

```sql
CREATE TABLE [IF NOT EXISTS] table_name(
   col1 data_type column_constraint,
   col2 data_type column_constraint,
   ...,
   table_constraints
) ENGINE=storage_engine;

```

其中，data_type 定义字段的数据类型，常用的数据类型包括：SMALLINT、INT、BIGINT、DECIMAL、CHAR、VARCHAR、TEXT、DATE、DATETIME 等。数据库约束包括主键约束（PRIMARY KEY）、外键约束（FOREIGN KEY）、唯一约束（UNIQUE）、非空约束（NOT NULL）、检查约束（CHECK）以及默认值（DEFAULT）。


# 查看所有表

使用`SHOW TABLES`语句查看当前数据库中的所有表：

```sql
mysql> show tables;
+------------------+
| Tables_in_testdb |
+------------------+
| departments      |
| employees        |
| jobs             |
+------------------+
3 rows in set (0.01 sec)

```

# 查看表结构

MySQL 提供了查看表结构的`DESCRIBE`语句：

```sql
mysql> desc employees;
```

